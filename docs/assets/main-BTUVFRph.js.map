{"version":3,"file":"main-BTUVFRph.js","sources":["../../src/main.ts"],"sourcesContent":["/**\r\n * Main Entry Point for Vite\r\n * \r\n * This file is the entry point referenced by index.html.\r\n * Vite will compile and bundle this TypeScript into browser-compatible JavaScript.\r\n */\r\n\r\nimport './main.css';\r\nimport { P2PGameRoom } from './p2p/browserRoom';\r\nimport { P2PGameClient } from './p2p/browserClient';\r\nimport { ActionType, GameAction } from './types/domain';\r\n\r\n// Global instances\r\nlet gameRoom: P2PGameRoom | null = null;\r\nlet gameClient: P2PGameClient | null = null;\r\nlet currentPlayerId: string = '';\r\nlet isHost: boolean = false;\r\n\r\n// Main application initialization\r\nfunction initApp() {\r\n  const app = document.getElementById('app');\r\n  \r\n  if (!app) {\r\n    console.error('App mount point not found');\r\n    return;\r\n  }\r\n  \r\n  // Render UI\r\n  app.innerHTML = `\r\n    <div class=\"container\">\r\n      <h1>Century: Golem Edition</h1>\r\n      <p class=\"subtitle\">Peer-to-Peer Multiplayer - No Server Required</p>\r\n      \r\n      <div class=\"tabs\">\r\n        <button class=\"tab-btn active\" data-tab=\"create\">Create Room</button>\r\n        <button class=\"tab-btn\" data-tab=\"join\">Join Room</button>\r\n      </div>\r\n      \r\n      <div class=\"tab-content active\" id=\"create-tab\">\r\n        <h2>Create a Game Room</h2>\r\n        <form id=\"create-form\">\r\n          <div class=\"form-group\">\r\n            <label>Your Name:</label>\r\n            <input type=\"text\" id=\"host-name-input\" placeholder=\"Enter your name\" required />\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>Number of Players:</label>\r\n            <input type=\"number\" id=\"player-count\" min=\"2\" max=\"5\" value=\"3\" />\r\n          </div>\r\n          <button type=\"submit\" class=\"btn-primary\">Create Room</button>\r\n        </form>\r\n        <div id=\"room-info\" style=\"display:none;\">\r\n          <h3>Room Created</h3>\r\n          <p><strong>Share this Room Code with other players:</strong></p>\r\n          <div style=\"margin: 15px 0;\">\r\n            <div class=\"room-code\" id=\"room-code-display\"></div>\r\n          </div>\r\n          <div id=\"players-waiting\" style=\"margin-top: 20px;\">\r\n            <h4>Players Connected: <span id=\"connected-count\">1</span>/<span id=\"total-count\">3</span></h4>\r\n            <div id=\"player-list\"></div>\r\n            <p style=\"margin-top: 15px; color: #6B5D50; font-size: 14px;\">Game will start automatically when all players join.</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"tab-content\" id=\"join-tab\">\r\n        <h2>Join a Game Room</h2>\r\n        <form id=\"join-form\">\r\n          <div class=\"form-group\">\r\n            <label>Room Code:</label>\r\n            <input type=\"text\" id=\"room-code-input\" placeholder=\"e.g., A3F9K2\" required />\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>Your Name:</label>\r\n            <input type=\"text\" id=\"player-name-input\" placeholder=\"Enter your name\" required />\r\n          </div>\r\n          <button type=\"submit\" class=\"btn-primary\">Join Room</button>\r\n        </form>\r\n      </div>\r\n      \r\n      <div id=\"game-area\" style=\"display:none;\">\r\n        <h2>Game in Progress</h2>\r\n        \r\n        <div id=\"player-identity\" class=\"info-panel\">\r\n          <strong>You are:</strong> <span id=\"your-player-name\"></span>\r\n          <span id=\"host-indicator\" style=\"display:none;\" class=\"badge-host\">HOST</span>\r\n        </div>\r\n        \r\n        <div id=\"turn-status\" class=\"info-panel turn-indicator\">\r\n          <strong id=\"turn-message\">Waiting...</strong>\r\n        </div>\r\n        \r\n        <div id=\"status-message\" class=\"status-message\"></div>\r\n        \r\n        <div id=\"game-status\" class=\"game-meta\"></div>\r\n        \r\n        <div id=\"game-state\" class=\"game-state\">\r\n          <div class=\"player-section\">\r\n            <h4>Your Caravan</h4>\r\n            <div id=\"player-caravan\" class=\"caravan-display\"></div>\r\n          </div>\r\n          <div class=\"player-section\">\r\n            <h4>Your Hand</h4>\r\n            <div id=\"player-hand\" class=\"card-display\"></div>\r\n          </div>\r\n          <div class=\"player-section\">\r\n            <h4>Play Area</h4>\r\n            <div id=\"player-play-area\" class=\"card-display\"></div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div id=\"shared-board\" class=\"shared-board\">\r\n          <div class=\"board-section\">\r\n            <h4>Merchant Cards</h4>\r\n            <div id=\"merchant-row\" class=\"merchant-display\"></div>\r\n          </div>\r\n          <div class=\"board-section\">\r\n            <h4>Point Cards</h4>\r\n            <div id=\"point-row\" class=\"point-display\"></div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div id=\"game-actions\" class=\"action-buttons\">\r\n          <button class=\"btn-action\" id=\"action-play-card\" disabled>Play Card</button>\r\n          <button class=\"btn-action\" id=\"action-take-merchant\" disabled>Take Merchant</button>\r\n          <button class=\"btn-action\" id=\"action-claim-vp\" disabled>Claim Points</button>\r\n          <button class=\"btn-action\" id=\"action-rest\" disabled>Rest</button>\r\n        </div>\r\n        \r\n        <div id=\"action-log\" class=\"action-log\">\r\n          <h3>Action Log</h3>\r\n          <div id=\"action-log-content\"></div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div id=\"card-modal\" class=\"modal\" style=\"display:none;\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h3 id=\"modal-title\">Select Card</h3>\r\n            <button class=\"modal-close\" id=\"modal-close\">&times;</button>\r\n          </div>\r\n          <div class=\"modal-body\" id=\"modal-body\"></div>\r\n          <div class=\"modal-footer\">\r\n            <button class=\"btn-action\" id=\"modal-cancel\">Cancel</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n  \r\n  setupEventListeners();\r\n}\r\n\r\nfunction setupEventListeners() {\r\n  // Tab switching\r\n  const tabButtons = document.querySelectorAll('.tab-btn');\r\n  tabButtons.forEach(button => {\r\n    button.addEventListener('click', () => {\r\n      const tabName = button.getAttribute('data-tab');\r\n      if (tabName) {\r\n        switchTab(tabName);\r\n      }\r\n    });\r\n  });\r\n  \r\n  // Create room form\r\n  const createForm = document.getElementById('create-form');\r\n  createForm?.addEventListener('submit', handleCreateRoom);\r\n  \r\n  // Join room form\r\n  const joinForm = document.getElementById('join-form');\r\n  joinForm?.addEventListener('submit', handleJoinRoom);\r\n  \r\n  // Game action buttons with debounce\r\n  document.getElementById('action-play-card')?.addEventListener('click', () => handleGameAction('play-card'));\r\n  document.getElementById('action-take-merchant')?.addEventListener('click', () => handleGameAction('take-merchant'));\r\n  document.getElementById('action-claim-vp')?.addEventListener('click', () => handleGameAction('claim-vp'));\r\n  document.getElementById('action-rest')?.addEventListener('click', () => handleGameAction('rest'));\r\n}\r\n\r\nfunction switchTab(tabName: string) {\r\n  // Update buttons\r\n  document.querySelectorAll('.tab-btn').forEach(btn => {\r\n    btn.classList.remove('active');\r\n  });\r\n  document.querySelector(`[data-tab=\"${tabName}\"]`)?.classList.add('active');\r\n  \r\n  // Update content\r\n  document.querySelectorAll('.tab-content').forEach(content => {\r\n    content.classList.remove('active');\r\n  });\r\n  document.getElementById(`${tabName}-tab`)?.classList.add('active');\r\n}\r\n\r\nasync function handleCreateRoom(event: Event) {\r\n  event.preventDefault();\r\n  \r\n  const hostName = (document.getElementById('host-name-input') as HTMLInputElement).value.trim();\r\n  const playerCount = parseInt((document.getElementById('player-count') as HTMLInputElement).value);\r\n  \r\n  if (!hostName) {\r\n    alert('Please enter your name');\r\n    return;\r\n  }\r\n  \r\n  const roomInfo = document.getElementById('room-info');\r\n  const codeDisplay = document.getElementById('room-code-display');\r\n  \r\n  if (!roomInfo || !codeDisplay) return;\r\n  \r\n  try {\r\n    // Create P2P room\r\n    gameRoom = new P2PGameRoom();\r\n    \r\n    // Set up event listeners\r\n    gameRoom.on('room-created', ({ roomCode, hostPeerId, playerCount }) => {\r\n      codeDisplay.textContent = roomCode;\r\n      \r\n      const totalCount = document.getElementById('total-count');\r\n      if (totalCount) {\r\n        totalCount.textContent = playerCount.toString();\r\n      }\r\n      \r\n      // Host is automatically player_0 (first player)\r\n      const game = (gameRoom as any).game;\r\n      if (game && game.players && game.players.length > 0) {\r\n        currentPlayerId = game.players[0].id;\r\n        isHost = true;  // Mark that we are the host\r\n        const playerNameEl = document.getElementById('your-player-name');\r\n        if (playerNameEl) {\r\n          playerNameEl.textContent = game.players[0].name;\r\n        }\r\n        const hostIndicator = document.getElementById('host-indicator');\r\n        if (hostIndicator) {\r\n          hostIndicator.style.display = 'inline-block';\r\n        }\r\n      }\r\n      \r\n      updatePlayerList();\r\n      roomInfo.style.display = 'block';\r\n    });\r\n    \r\n    gameRoom.on('peer-connected', ({ playerName }) => {\r\n      updatePlayerList();\r\n    });\r\n    \r\n    gameRoom.on('game-state-updated', (game) => {\r\n      // Host also sees game updates\r\n      const gameArea = document.getElementById('game-area');\r\n      if (gameArea && game.phase === 'PLAYING') {\r\n        // Hide room info, show game\r\n        const roomInfo = document.getElementById('room-info');\r\n        if (roomInfo) {\r\n          roomInfo.style.display = 'none';\r\n        }\r\n        gameArea.style.display = 'block';\r\n        \r\n        updateGameUI(game);\r\n      }\r\n    });\r\n    \r\n    gameRoom.on('action-processed', (action, success) => {\r\n      if (success) {\r\n        showStatusMessage('Action processed successfully', 'success');\r\n        addActionToLog(action, currentPlayerId);\r\n      } else {\r\n        showStatusMessage('Action processing failed', 'error');\r\n      }\r\n    });\r\n    \r\n    gameRoom.on('room-error', (error: Error) => {\r\n      showStatusMessage(`Error: ${error.message}`, 'error');\r\n    });\r\n    \r\n    // Generate player names (host is first player)\r\n    const playerNames = [hostName, ...Array.from({ length: playerCount - 1 }, (_, i) => `Player ${i + 2}`)];\r\n    \r\n    // Create room\r\n    await gameRoom.createRoom(playerNames);\r\n    \r\n  } catch (error) {\r\n    alert(`Failed to create room: ${(error as Error).message}`);\r\n  }\r\n}\r\n\r\nfunction updatePlayerList() {\r\n  if (!gameRoom) return;\r\n  \r\n  const playerList = document.getElementById('player-list');\r\n  const connectedCount = document.getElementById('connected-count');\r\n  \r\n  if (!playerList || !connectedCount) return;\r\n  \r\n  const game = (gameRoom as any).game;\r\n  const connections = (gameRoom as any).playerConnections;\r\n  \r\n  if (!game) return;\r\n  \r\n  const connectedPlayerIds = new Set(\r\n    Array.from(connections.values()).map((conn: any) => conn.playerId)\r\n  );\r\n  \r\n  playerList.innerHTML = game.players.map((player: any, index: number) => {\r\n    const isConnected = connectedPlayerIds.has(player.id);\r\n    const statusIcon = isConnected ? '✅' : '⏳';\r\n    const statusText = isConnected ? 'Connected' : 'Waiting...';\r\n    const hostLabel = index === 0 ? ' (Host)' : '';\r\n    return `<div style=\"padding: 5px 0;\">${statusIcon} ${player.name}${hostLabel} - ${statusText}</div>`;\r\n  }).join('');\r\n  \r\n  connectedCount.textContent = connectedPlayerIds.size.toString();\r\n}\r\n\r\nasync function handleJoinRoom(event: Event) {\r\n  event.preventDefault();\r\n  \r\n  const roomCode = (document.getElementById('room-code-input') as HTMLInputElement).value.trim().toUpperCase();\r\n  const playerName = (document.getElementById('player-name-input') as HTMLInputElement).value.trim();\r\n  \r\n  if (!roomCode || !playerName) {\r\n    alert('Please fill in all fields');\r\n    return;\r\n  }\r\n  \r\n  // Derive peer ID from room code (same format as host)\r\n  const hostPeerId = `boardgame-${roomCode.toLowerCase()}`;\r\n  \r\n  try {\r\n    // Create P2P client\r\n    gameClient = new P2PGameClient();\r\n    \r\n    // Set up event listeners\r\n    gameClient.on('connected', () => {\r\n      // Hide forms, show game area\r\n      document.getElementById('create-tab')!.style.display = 'none';\r\n      document.getElementById('join-tab')!.style.display = 'none';\r\n      const gameArea = document.getElementById('game-area');\r\n      if (gameArea) {\r\n        gameArea.style.display = 'block';\r\n        // Set player identity\r\n        const playerNameEl = document.getElementById('your-player-name');\r\n        if (playerNameEl) {\r\n          playerNameEl.textContent = playerName;\r\n        }\r\n        showStatusMessage(`Connected to room ${roomCode}`, 'success');\r\n      }\r\n      isHost = false;  // Mark that we are NOT the host\r\n    });\r\n    \r\n    gameClient.on('disconnected', () => {\r\n      showStatusMessage('Disconnected from room', 'error');\r\n    });\r\n    \r\n    gameClient.on('host-disconnected', () => {\r\n      const gameArea = document.getElementById('game-area');\r\n      if (gameArea) {\r\n        gameArea.innerHTML = `\r\n          <h2>Game Ended</h2>\r\n          <p style=\"padding: 20px; background: rgba(244, 67, 54, 0.2); border-radius: 8px;\">\r\n            <strong>Host disconnected.</strong><br><br>\r\n            The host has closed their browser or lost connection.<br>\r\n            The game cannot continue without the host.<br><br>\r\n            Please refresh to start a new game.\r\n          </p>\r\n        `;\r\n      }\r\n    });\r\n    \r\n    gameClient.on('game-state-received', (game) => {\r\n      updateGameUI(game);\r\n      addActionToLog(null, currentPlayerId);\r\n    });\r\n    \r\n    gameClient.on('action-accepted', (action) => {\r\n      showStatusMessage('Sending action to host...', 'info');\r\n    });\r\n    \r\n    gameClient.on('action-rejected', (action, error) => {\r\n      showStatusMessage(`Invalid action: ${error}`, 'error');\r\n    });\r\n    \r\n    gameClient.on('error', (error: Error) => {\r\n      showStatusMessage(`Error: ${error.message}`, 'error');\r\n    });\r\n    \r\n    // Generate player ID and store it\r\n    currentPlayerId = `player_${Date.now()}`;\r\n    \r\n    // Join room\r\n    await gameClient.joinRoomWithPeerId(roomCode, hostPeerId, currentPlayerId, playerName);\r\n    \r\n  } catch (error) {\r\n    alert(`Failed to join room: ${(error as Error).message}`);\r\n  }\r\n}\r\n\r\nfunction generateRoomCode(): string {\r\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';\r\n  let code = '';\r\n  for (let i = 0; i < 6; i++) {\r\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\r\n  }\r\n  return code;\r\n}\r\n\r\n// Game action handler\r\nlet actionInProgress = false;\r\n\r\nasync function executeAction(action: GameAction) {\r\n  if (isHost) {\r\n    // Host processes action directly\r\n    showStatusMessage('Processing action...', 'info');\r\n    const result = (gameRoom as any).processAction(action);\r\n    if (result.valid) {\r\n      showStatusMessage('Action processed successfully', 'success');\r\n      addActionToLog(action, currentPlayerId);\r\n    } else {\r\n      showStatusMessage(`Invalid action: ${result.error}`, 'error');\r\n    }\r\n    actionInProgress = false;\r\n  } else {\r\n    // Client sends action to host\r\n    if (!gameClient) {\r\n      showStatusMessage('Not connected to room', 'error');\r\n      actionInProgress = false;\r\n      return;\r\n    }\r\n    showStatusMessage('Sending action to host...', 'info');\r\n    await gameClient.sendAction(action);\r\n  }\r\n}\r\n\r\nasync function handleGameAction(actionType: string) {\r\n  if (actionInProgress) {\r\n    return;\r\n  }\r\n  \r\n  if (!currentPlayerId) {\r\n    showStatusMessage('Player ID not set', 'error');\r\n    return;\r\n  }\r\n  \r\n  if (isHost && !gameRoom) {\r\n    showStatusMessage('Host room not initialized', 'error');\r\n    return;\r\n  }\r\n  \r\n  if (!isHost && !gameClient) {\r\n    showStatusMessage('Not connected to a room', 'error');\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    actionInProgress = true;\r\n    disableAllActionButtons();\r\n    \r\n    let action: GameAction;\r\n    \r\n    switch (actionType) {\r\n      case 'rest':\r\n        action = {\r\n          type: ActionType.Rest,\r\n          playerId: currentPlayerId,\r\n          timestamp: Date.now()\r\n        };\r\n        break;\r\n        \r\n      case 'play-card':\r\n        await showCardSelectionModal('Play a card from your hand', 'hand', async (cardId: string) => {\r\n          action = {\r\n            type: ActionType.PlayMerchantCard,\r\n            playerId: currentPlayerId,\r\n            timestamp: Date.now(),\r\n            cardId\r\n          };\r\n          await executeAction(action);\r\n        });\r\n        return;\r\n        \r\n      case 'take-merchant':\r\n        await showCardSelectionModal('Acquire merchant card', 'merchant-row', async (cardIndex: string) => {\r\n          const game = isHost ? (gameRoom as any).game : (gameClient as any)?.lastGameState;\r\n          const idx = parseInt(cardIndex);\r\n          const card = game?.merchantRow.cards[idx];\r\n          if (!card) {\r\n            showStatusMessage('Invalid card selection', 'error');\r\n            actionInProgress = false;\r\n            return;\r\n          }\r\n          action = {\r\n            type: ActionType.AcquireMerchantCard,\r\n            playerId: currentPlayerId,\r\n            timestamp: Date.now(),\r\n            rowIndex: idx,\r\n            cardId: card.id\r\n          };\r\n          await executeAction(action);\r\n        });\r\n        return;\r\n        \r\n      case 'claim-vp':\r\n        await showCardSelectionModal('Claim point card', 'point-row', async (cardIndex: string) => {\r\n          const game = isHost ? (gameRoom as any).game : (gameClient as any)?.lastGameState;\r\n          const idx = parseInt(cardIndex);\r\n          const card = game?.pointCardRow.cards[idx];\r\n          if (!card) {\r\n            showStatusMessage('Invalid card selection', 'error');\r\n            actionInProgress = false;\r\n            return;\r\n          }\r\n          // Use the card's cost as payment (game engine will validate)\r\n          action = {\r\n            type: ActionType.ClaimPointCard,\r\n            playerId: currentPlayerId,\r\n            timestamp: Date.now(),\r\n            rowIndex: idx,\r\n            cardId: card.id,\r\n            payment: card.cost\r\n          };\r\n          await executeAction(action);\r\n        });\r\n        return;\r\n        \r\n      default:\r\n        showStatusMessage('Unknown action type', 'error');\r\n        actionInProgress = false;\r\n        return;\r\n    }\r\n    \r\n    await executeAction(action);\r\n    \r\n  } catch (error) {\r\n    showStatusMessage(`Failed to send action: ${(error as Error).message}`, 'error');\r\n    actionInProgress = false;\r\n  }\r\n}\r\n\r\n// Card selection modal\r\nfunction showCardSelectionModal(title: string, source: string, onSelect: (selection: string) => Promise<void>): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    const modal = document.getElementById('card-modal');\r\n    const modalTitle = document.getElementById('modal-title');\r\n    const modalBody = document.getElementById('modal-body');\r\n    const modalClose = document.getElementById('modal-close');\r\n    const modalCancel = document.getElementById('modal-cancel');\r\n    \r\n    if (!modal || !modalTitle || !modalBody || !modalClose || !modalCancel) {\r\n      actionInProgress = false;\r\n      resolve();\r\n      return;\r\n    }\r\n    \r\n    modalTitle.textContent = title;\r\n    modalBody.innerHTML = '';\r\n    \r\n    // Get game state\r\n    const game = isHost ? (gameRoom as any).game : (gameClient as any)?.lastGameState;\r\n    if (!game) {\r\n      showStatusMessage('Game state not available', 'error');\r\n      actionInProgress = false;\r\n      resolve();\r\n      return;\r\n    }\r\n    \r\n    const myPlayer = game.players.find((p: any) => p.id === currentPlayerId);\r\n    if (!myPlayer) {\r\n      showStatusMessage('Player not found', 'error');\r\n      actionInProgress = false;\r\n      resolve();\r\n      return;\r\n    }\r\n    \r\n    let items: any[] = [];\r\n    \r\n    if (source === 'hand') {\r\n      items = myPlayer.hand;\r\n    } else if (source === 'merchant-row') {\r\n      items = game.merchantRow.cards.filter((c: any) => c !== null);\r\n    } else if (source === 'point-row') {\r\n      items = game.pointRow.cards.filter((c: any) => c !== null);\r\n    }\r\n    \r\n    if (items.length === 0) {\r\n      modalBody.innerHTML = '<p style=\"padding: 20px; text-align: center; color: #6B5D50;\">No cards available</p>';\r\n    } else {\r\n      items.forEach((item, index) => {\r\n        const button = document.createElement('button');\r\n        button.className = 'btn-action card-select-btn';\r\n        button.style.width = '100%';\r\n        button.style.marginBottom = '10px';\r\n        \r\n        if (source === 'hand') {\r\n          button.textContent = formatCardName(item);\r\n          button.onclick = async () => {\r\n            modal.style.display = 'none';\r\n            await onSelect(item.id);\r\n            resolve();\r\n          };\r\n        } else {\r\n          const actualIndex = source === 'merchant-row' \r\n            ? game.merchantRow.cards.findIndex((c: any) => c && c.id === item.id)\r\n            : game.pointRow.cards.findIndex((c: any) => c && c.id === item.id);\r\n          button.textContent = formatCardName(item);\r\n          button.onclick = async () => {\r\n            modal.style.display = 'none';\r\n            await onSelect(actualIndex.toString());\r\n            resolve();\r\n          };\r\n        }\r\n        \r\n        modalBody.appendChild(button);\r\n      });\r\n    }\r\n    \r\n    const closeModal = () => {\r\n      modal.style.display = 'none';\r\n      actionInProgress = false;\r\n      resolve();\r\n    };\r\n    \r\n    modalClose.onclick = closeModal;\r\n    modalCancel.onclick = closeModal;\r\n    \r\n    modal.style.display = 'flex';\r\n  });\r\n}\r\n\r\nfunction formatCardName(card: any): string {\r\n  if (card.type === 'PRODUCE') {\r\n    const crystals = Object.entries(card.produces)\r\n      .filter(([_, count]) => (count as number) > 0)\r\n      .map(([color, count]) => `${count} ${color}`)\r\n      .join(', ');\r\n    return `Produce: ${crystals}`;\r\n  } else if (card.type === 'UPGRADE') {\r\n    return `Upgrade: ${card.upgrades.length} levels`;\r\n  } else if (card.type === 'TRADE') {\r\n    return 'Trade Card';\r\n  } else if (card.points !== undefined) {\r\n    return `${card.points} Points`;\r\n  }\r\n  return 'Card';\r\n}\r\n\r\nfunction updatePlayerDisplay(game: any) {\r\n  const myPlayer = game.players.find((p: any) => p.id === currentPlayerId);\r\n  if (!myPlayer) return;\r\n  \r\n  // Update caravan\r\n  const caravanEl = document.getElementById('player-caravan');\r\n  if (caravanEl) {\r\n    const crystals = Object.entries(myPlayer.caravan)\r\n      .filter(([_, count]) => (count as number) > 0)\r\n      .map(([color, count]) => `<span class=\"crystal crystal-${color.toLowerCase()}\">${color}: ${count}</span>`)\r\n      .join(' ');\r\n    caravanEl.innerHTML = crystals || '<span style=\"color: #8B7355;\">Empty</span>';\r\n  }\r\n  \r\n  // Update hand\r\n  const handEl = document.getElementById('player-hand');\r\n  if (handEl) {\r\n    if (myPlayer.hand.length === 0) {\r\n      handEl.innerHTML = '<span style=\"color: #8B7355;\">No cards</span>';\r\n    } else {\r\n      handEl.innerHTML = myPlayer.hand\r\n        .map((card: any) => `<div class=\"card-item\">${formatCardName(card)}</div>`)\r\n        .join('');\r\n    }\r\n  }\r\n  \r\n  // Update play area\r\n  const playAreaEl = document.getElementById('player-play-area');\r\n  if (playAreaEl) {\r\n    if (myPlayer.playArea.length === 0) {\r\n      playAreaEl.innerHTML = '<span style=\"color: #8B7355;\">No cards played</span>';\r\n    } else {\r\n      playAreaEl.innerHTML = myPlayer.playArea\r\n        .map((card: any) => `<div class=\"card-item\">${formatCardName(card)}</div>`)\r\n        .join('');\r\n    }\r\n  }\r\n  \r\n  // Update merchant row\r\n  const merchantRowEl = document.getElementById('merchant-row');\r\n  if (merchantRowEl) {\r\n    merchantRowEl.innerHTML = game.merchantRow.cards\r\n      .map((card: any, i: number) => {\r\n        if (card === null) {\r\n          return `<div class=\"card-slot empty\">Slot ${i + 1}: Empty</div>`;\r\n        }\r\n        return `<div class=\"card-slot\">${formatCardName(card)}</div>`;\r\n      })\r\n      .join('');\r\n  }\r\n  \r\n  // Update point row\r\n  const pointRowEl = document.getElementById('point-row');\r\n  if (pointRowEl) {\r\n    pointRowEl.innerHTML = game.pointRow.cards\r\n      .map((card: any, i: number) => {\r\n        if (card === null) {\r\n          return `<div class=\"card-slot empty\">Slot ${i + 1}: Empty</div>`;\r\n        }\r\n        return `<div class=\"card-slot\">${card.points} Points</div>`;\r\n      })\r\n      .join('');\r\n  }\r\n}\r\n\r\n// Update UI with game state\r\nfunction updateGameUI(game: any) {\r\n  const currentPlayer = game.players[game.currentPlayerIndex];\r\n  const isMyTurn = currentPlayer?.id === currentPlayerId;\r\n  const myPlayer = game.players.find((p: any) => p.id === currentPlayerId);\r\n  const gameEnded = game.phase === 'FINISHED';\r\n  \r\n  // Update turn status message\r\n  const turnMessage = document.getElementById('turn-message');\r\n  const turnStatus = document.getElementById('turn-status');\r\n  if (turnMessage && turnStatus) {\r\n    if (gameEnded) {\r\n      turnMessage.textContent = 'Game Over';\r\n      turnStatus.className = 'info-panel turn-indicator turn-ended';\r\n    } else if (isMyTurn) {\r\n      turnMessage.textContent = 'YOUR TURN';\r\n      turnStatus.className = 'info-panel turn-indicator turn-active';\r\n    } else {\r\n      turnMessage.textContent = `Waiting for ${currentPlayer?.name || 'opponent'}`;\r\n      turnStatus.className = 'info-panel turn-indicator turn-waiting';\r\n    }\r\n  }\r\n  \r\n  // Update game status details\r\n  const statusEl = document.getElementById('game-status');\r\n  if (statusEl) {\r\n    statusEl.textContent = `Turn ${game.turnNumber} • ${game.phase} • ${game.players.length} players`;\r\n  }\r\n  \r\n  // Enable/disable action buttons based on turn and game state\r\n  updateActionButtons(isMyTurn, gameEnded);\r\n  \r\n  // Update player display\r\n  updatePlayerDisplay(game);\r\n  \r\n  // Clear action in progress flag when state updates\r\n  actionInProgress = false;\r\n}\r\n\r\nfunction updateActionButtons(isMyTurn: boolean, gameEnded: boolean) {\r\n  const actionButtons = document.querySelectorAll<HTMLButtonElement>('#game-actions button');\r\n  const canAct = isMyTurn && !gameEnded && !actionInProgress;\r\n  \r\n  actionButtons.forEach((btn) => {\r\n    btn.disabled = !canAct;\r\n    if (canAct) {\r\n      btn.classList.remove('btn-disabled');\r\n    } else {\r\n      btn.classList.add('btn-disabled');\r\n    }\r\n  });\r\n}\r\n\r\nfunction disableAllActionButtons() {\r\n  const actionButtons = document.querySelectorAll<HTMLButtonElement>('#game-actions button');\r\n  actionButtons.forEach((btn) => {\r\n    btn.disabled = true;\r\n    btn.classList.add('btn-disabled');\r\n  });\r\n}\r\n\r\n// Show status message feedback\r\nfunction showStatusMessage(message: string, type: 'success' | 'error' | 'info') {\r\n  const statusEl = document.getElementById('status-message');\r\n  if (!statusEl) return;\r\n  \r\n  statusEl.textContent = message;\r\n  statusEl.className = `status-message status-${type}`;\r\n  statusEl.style.display = 'block';\r\n  \r\n  // Auto-hide after 5 seconds\r\n  setTimeout(() => {\r\n    if (statusEl) {\r\n      statusEl.style.display = 'none';\r\n    }\r\n  }, 5000);\r\n}\r\n\r\n// Action log management\r\nconst actionLogEntries: string[] = [];\r\nconst MAX_LOG_ENTRIES = 10;\r\n\r\nfunction addActionToLog(action: GameAction | null, playerId: string) {\r\n  if (!gameRoom) return;\r\n  \r\n  const game = (gameRoom as any).game;\r\n  if (!game) return;\r\n  \r\n  if (action) {\r\n    const player = game.players.find((p: any) => p.id === action.playerId);\r\n    const actionText = formatActionForLog(action, player?.name || 'Unknown');\r\n    \r\n    actionLogEntries.unshift(actionText);\r\n    if (actionLogEntries.length > MAX_LOG_ENTRIES) {\r\n      actionLogEntries.pop();\r\n    }\r\n    \r\n    renderActionLog();\r\n  }\r\n}\r\n\r\nfunction formatActionForLog(action: GameAction, playerName: string): string {\r\n  const timestamp = new Date(action.timestamp).toLocaleTimeString();\r\n  let actionDesc = '';\r\n  \r\n  switch (action.type) {\r\n    case ActionType.Rest:\r\n      actionDesc = 'rested and took all cards back';\r\n      break;\r\n    case ActionType.PlayMerchantCard:\r\n      actionDesc = 'played a merchant card';\r\n      break;\r\n    case ActionType.AcquireMerchantCard:\r\n      actionDesc = 'acquired a merchant card';\r\n      break;\r\n    case ActionType.ClaimPointCard:\r\n      actionDesc = 'claimed a point card';\r\n      break;\r\n    default:\r\n      actionDesc = 'performed an action';\r\n  }\r\n  \r\n  return `[${timestamp}] ${playerName} ${actionDesc}`;\r\n}\r\n\r\nfunction renderActionLog() {\r\n  const logContent = document.getElementById('action-log-content');\r\n  if (!logContent) return;\r\n  \r\n  if (actionLogEntries.length === 0) {\r\n    logContent.innerHTML = '<div class=\"log-empty\">No actions yet</div>';\r\n  } else {\r\n    logContent.innerHTML = actionLogEntries\r\n      .map(entry => `<div class=\"log-entry\">${entry}</div>`)\r\n      .join('');\r\n  }\r\n}\r\n\r\n// Initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initApp);\r\n} else {\r\n  initApp();\r\n}\r\n"],"names":["gameRoom","gameClient","currentPlayerId","isHost","initApp","app","document","getElementById","innerHTML","querySelectorAll","forEach","button","addEventListener","tabName","getAttribute","btn","classList","remove","querySelector","add","content","switchTab","createForm","handleCreateRoom","joinForm","handleJoinRoom","handleGameAction","setupEventListeners","console","error","async","event","preventDefault","hostName","value","trim","playerCount","parseInt","alert","roomInfo","codeDisplay","P2PGameRoom","on","roomCode","hostPeerId","textContent","totalCount","toString","game","players","length","id","playerNameEl","name","hostIndicator","style","display","updatePlayerList","playerName","gameArea","phase","updateGameUI","action","success","showStatusMessage","addActionToLog","message","playerNames","Array","from","_","i","createRoom","playerList","connectedCount","connections","playerConnections","connectedPlayerIds","Set","values","map","conn","playerId","player","index","isConnected","has","statusText","hostLabel","join","size","toUpperCase","toLowerCase","P2PGameClient","Date","now","joinRoomWithPeerId","actionInProgress","executeAction","result","processAction","valid","sendAction","actionType","disabled","type","ActionType","Rest","timestamp","showCardSelectionModal","cardId","PlayMerchantCard","cardIndex","lastGameState","idx","card","merchantRow","cards","AcquireMerchantCard","rowIndex","pointCardRow","ClaimPointCard","payment","cost","title","source","onSelect","Promise","resolve","modal","modalTitle","modalBody","modalClose","modalCancel","myPlayer","find","p","items","hand","filter","c","pointRow","item","createElement","className","width","marginBottom","formatCardName","onclick","actualIndex","findIndex","appendChild","closeModal","Object","entries","produces","count","color","upgrades","points","currentPlayer","currentPlayerIndex","isMyTurn","gameEnded","turnMessage","turnStatus","statusEl","turnNumber","actionButtons","canAct","updateActionButtons","caravanEl","crystals","caravan","handEl","playAreaEl","playArea","merchantRowEl","pointRowEl","updatePlayerDisplay","setTimeout","actionLogEntries","MAX_LOG_ENTRIES","actionText","toLocaleTimeString","actionDesc","formatActionForLog","unshift","pop","logContent","entry","renderActionLog","readyState"],"mappings":"kzBAaA,IAAIA,EAA+B,KAC/BC,EAAmC,KACnCC,EAA0B,GAC1BC,GAAkB,EAGtB,SAASC,IACP,MAAMC,EAAMC,SAASC,eAAe,OAE/BF,GAMLA,EAAIG,UAAY,ozJA6HlB,WAEqBF,SAASG,iBAAiB,YAClCC,QAAQC,IACjBA,EAAOC,iBAAiB,QAAS,KAC/B,MAAMC,EAAUF,EAAOG,aAAa,YAChCD,GAqBV,SAAmBA,GAEjBP,SAASG,iBAAiB,YAAYC,QAAQK,IAC5CA,EAAIC,UAAUC,OAAO,YAEvBX,SAASY,cAAc,cAAcL,QAAcG,UAAUG,IAAI,UAGjEb,SAASG,iBAAiB,gBAAgBC,QAAQU,IAChDA,EAAQJ,UAAUC,OAAO,YAE3BX,SAASC,eAAe,GAAGM,UAAgBG,UAAUG,IAAI,SAC3D,CAhCQE,CAAUR,OAMhB,MAAMS,EAAahB,SAASC,eAAe,eAC3Ce,GAAYV,iBAAiB,SAAUW,GAGvC,MAAMC,EAAWlB,SAASC,eAAe,aACzCiB,GAAUZ,iBAAiB,SAAUa,GAGrCnB,SAASC,eAAe,qBAAqBK,iBAAiB,QAAS,IAAMc,EAAiB,cAC9FpB,SAASC,eAAe,yBAAyBK,iBAAiB,QAAS,IAAMc,EAAiB,kBAClGpB,SAASC,eAAe,oBAAoBK,iBAAiB,QAAS,IAAMc,EAAiB,aAC7FpB,SAASC,eAAe,gBAAgBK,iBAAiB,QAAS,IAAMc,EAAiB,QAC3F,CA5BEC,IA/HEC,QAAQC,MAAM,4BAgIlB,CA2CAC,eAAeP,EAAiBQ,GAC9BA,EAAMC,iBAEN,MAAMC,EAAY3B,SAASC,eAAe,mBAAwC2B,MAAMC,OAClFC,EAAcC,SAAU/B,SAASC,eAAe,gBAAqC2B,OAE3F,IAAKD,EAEH,YADAK,MAAM,0BAIR,MAAMC,EAAWjC,SAASC,eAAe,aACnCiC,EAAclC,SAASC,eAAe,qBAE5C,GAAKgC,GAAaC,EAElB,IAEExC,EAAW,IAAIyC,EAGfzC,EAAS0C,GAAG,eAAgB,EAAGC,WAAUC,aAAYR,YAAAA,MACnDI,EAAYK,YAAcF,EAE1B,MAAMG,EAAaxC,SAASC,eAAe,eACvCuC,IACFA,EAAWD,YAAcT,EAAYW,YAIvC,MAAMC,EAAQhD,EAAiBgD,KAC/B,GAAIA,GAAQA,EAAKC,SAAWD,EAAKC,QAAQC,OAAS,EAAG,CACnDhD,EAAkB8C,EAAKC,QAAQ,GAAGE,GAClChD,GAAS,EACT,MAAMiD,EAAe9C,SAASC,eAAe,oBACzC6C,IACFA,EAAaP,YAAcG,EAAKC,QAAQ,GAAGI,MAE7C,MAAMC,EAAgBhD,SAASC,eAAe,kBAC1C+C,IACFA,EAAcC,MAAMC,QAAU,eAElC,CAEAC,IACAlB,EAASgB,MAAMC,QAAU,UAG3BxD,EAAS0C,GAAG,iBAAkB,EAAGgB,iBAC/BD,MAGFzD,EAAS0C,GAAG,qBAAuBM,IAEjC,MAAMW,EAAWrD,SAASC,eAAe,aACzC,GAAIoD,GAA2B,YAAfX,EAAKY,MAAqB,CAExC,MAAMrB,EAAWjC,SAASC,eAAe,aACrCgC,IACFA,EAASgB,MAAMC,QAAU,QAE3BG,EAASJ,MAAMC,QAAU,QAEzBK,EAAab,EACf,IAGFhD,EAAS0C,GAAG,mBAAoB,CAACoB,EAAQC,KACnCA,GACFC,EAAkB,gCAAiC,WACnDC,EAAeH,EAAQ5D,IAEvB8D,EAAkB,2BAA4B,WAIlDhE,EAAS0C,GAAG,aAAeb,IACzBmC,EAAkB,UAAUnC,EAAMqC,UAAW,WAI/C,MAAMC,EAAc,CAAClC,KAAamC,MAAMC,KAAK,CAAEnB,OAAQd,EAAc,GAAK,CAACkC,EAAGC,IAAM,UAAUA,EAAI,YAG5FvE,EAASwE,WAAWL,EAE5B,OAAStC,GACPS,MAAM,0BAA2BT,EAAgBqC,UACnD,CACF,CAEA,SAAST,IACP,IAAKzD,EAAU,OAEf,MAAMyE,EAAanE,SAASC,eAAe,eACrCmE,EAAiBpE,SAASC,eAAe,mBAE/C,IAAKkE,IAAeC,EAAgB,OAEpC,MAAM1B,EAAQhD,EAAiBgD,KACzB2B,EAAe3E,EAAiB4E,kBAEtC,IAAK5B,EAAM,OAEX,MAAM6B,EAAqB,IAAIC,IAC7BV,MAAMC,KAAKM,EAAYI,UAAUC,IAAKC,GAAcA,EAAKC,WAG3DT,EAAWjE,UAAYwC,EAAKC,QAAQ+B,IAAI,CAACG,EAAaC,KACpD,MAAMC,EAAcR,EAAmBS,IAAIH,EAAOhC,IAE5CoC,EAAaF,EAAc,YAAc,aACzCG,EAAsB,IAAVJ,EAAc,UAAY,GAC5C,MAAO,gCAHYC,EAAc,IAAM,OAGcF,EAAO9B,OAAOmC,OAAeD,YACjFE,KAAK,IAERf,EAAe7B,YAAcgC,EAAmBa,KAAK3C,UACvD,CAEAjB,eAAeL,EAAeM,GAC5BA,EAAMC,iBAEN,MAAMW,EAAYrC,SAASC,eAAe,mBAAwC2B,MAAMC,OAAOwD,cACzFjC,EAAcpD,SAASC,eAAe,qBAA0C2B,MAAMC,OAE5F,IAAKQ,IAAae,EAEhB,YADApB,MAAM,6BAKR,MAAMM,EAAa,aAAaD,EAASiD,gBAEzC,IAEE3F,EAAa,IAAI4F,EAGjB5F,EAAWyC,GAAG,YAAa,KAEzBpC,SAASC,eAAe,cAAegD,MAAMC,QAAU,OACvDlD,SAASC,eAAe,YAAagD,MAAMC,QAAU,OACrD,MAAMG,EAAWrD,SAASC,eAAe,aACzC,GAAIoD,EAAU,CACZA,EAASJ,MAAMC,QAAU,QAEzB,MAAMJ,EAAe9C,SAASC,eAAe,oBACzC6C,IACFA,EAAaP,YAAca,GAE7BM,EAAkB,qBAAqBrB,IAAY,UACrD,CACAxC,GAAS,IAGXF,EAAWyC,GAAG,eAAgB,KAC5BsB,EAAkB,yBAA0B,WAG9C/D,EAAWyC,GAAG,oBAAqB,KACjC,MAAMiB,EAAWrD,SAASC,eAAe,aACrCoD,IACFA,EAASnD,UAAY,8YAYzBP,EAAWyC,GAAG,sBAAwBM,IACpCa,EAAab,GACbiB,EAAe,KAAM/D,KAGvBD,EAAWyC,GAAG,kBAAoBoB,IAChCE,EAAkB,4BAA6B,UAGjD/D,EAAWyC,GAAG,kBAAmB,CAACoB,EAAQjC,KACxCmC,EAAkB,mBAAmBnC,IAAS,WAGhD5B,EAAWyC,GAAG,QAAUb,IACtBmC,EAAkB,UAAUnC,EAAMqC,UAAW,WAI/ChE,EAAkB,UAAU4F,KAAKC,cAG3B9F,EAAW+F,mBAAmBrD,EAAUC,EAAY1C,EAAiBwD,EAE7E,OAAS7B,GACPS,MAAM,wBAAyBT,EAAgBqC,UACjD,CACF,CAYA,IAAI+B,GAAmB,EAEvBnE,eAAeoE,EAAcpC,GAC3B,GAAI3D,EAAQ,CAEV6D,EAAkB,uBAAwB,QAC1C,MAAMmC,EAAUnG,EAAiBoG,cAActC,GAC3CqC,EAAOE,OACTrC,EAAkB,gCAAiC,WACnDC,EAAeH,IAEfE,EAAkB,mBAAmBmC,EAAOtE,QAAS,SAEvDoE,GAAmB,CACrB,KAAO,CAEL,IAAKhG,EAGH,OAFA+D,EAAkB,wBAAyB,cAC3CiC,GAAmB,GAGrBjC,EAAkB,4BAA6B,cACzC/D,EAAWqG,WAAWxC,EAC9B,CACF,CAEAhC,eAAeJ,EAAiB6E,GAC9B,IAAIN,EAIJ,GAAK/F,EAKL,IAAIC,GAAWH,EAKf,GAAKG,GAAWF,EAKhB,IAIE,IAAI6D,EAEJ,OALAmC,GAAmB,EAsTC3F,SAASG,iBAAoC,wBACrDC,QAASK,IACrBA,EAAIyF,UAAW,EACfzF,EAAIC,UAAUG,IAAI,kBApTVoF,GACN,IAAK,OACHzC,EAAS,CACP2C,KAAMC,EAAWC,KACjBzB,SAAUhF,EACV0G,UAAWd,KAAKC,OAElB,MAEF,IAAK,YAUH,kBATMc,EAAuB,6BAA8B,OAAQ/E,MAAOgF,IACxEhD,EAAS,CACP2C,KAAMC,EAAWK,iBACjB7B,SAAUhF,EACV0G,UAAWd,KAAKC,MAChBe,gBAEIZ,EAAcpC,MAIxB,IAAK,gBAmBH,kBAlBM+C,EAAuB,wBAAyB,eAAgB/E,MAAOkF,IAC3E,MAAMhE,EAAO7C,EAAUH,EAAiBgD,KAAQ/C,GAAoBgH,cAC9DC,EAAM7E,SAAS2E,GACfG,EAAOnE,GAAMoE,YAAYC,MAAMH,GACrC,IAAKC,EAGH,OAFAnD,EAAkB,yBAA0B,cAC5CiC,GAAmB,GAGrBnC,EAAS,CACP2C,KAAMC,EAAWY,oBACjBpC,SAAUhF,EACV0G,UAAWd,KAAKC,MAChBwB,SAAUL,EACVJ,OAAQK,EAAKhE,UAET+C,EAAcpC,MAIxB,IAAK,WAqBH,kBApBM+C,EAAuB,mBAAoB,YAAa/E,MAAOkF,IACnE,MAAMhE,EAAO7C,EAAUH,EAAiBgD,KAAQ/C,GAAoBgH,cAC9DC,EAAM7E,SAAS2E,GACfG,EAAOnE,GAAMwE,aAAaH,MAAMH,GACtC,IAAKC,EAGH,OAFAnD,EAAkB,yBAA0B,cAC5CiC,GAAmB,GAIrBnC,EAAS,CACP2C,KAAMC,EAAWe,eACjBvC,SAAUhF,EACV0G,UAAWd,KAAKC,MAChBwB,SAAUL,EACVJ,OAAQK,EAAKhE,GACbuE,QAASP,EAAKQ,YAEVzB,EAAcpC,MAIxB,QAGE,OAFAE,EAAkB,sBAAuB,cACzCiC,GAAmB,SAIjBC,EAAcpC,EAEtB,OAASjC,GACPmC,EAAkB,0BAA2BnC,EAAgBqC,UAAW,SACxE+B,GAAmB,CACrB,MAtFEjC,EAAkB,0BAA2B,cAL7CA,EAAkB,4BAA6B,cAL/CA,EAAkB,oBAAqB,QAiG3C,CAGA,SAAS6C,EAAuBe,EAAeC,EAAgBC,GAC7D,OAAO,IAAIC,QAASC,IAClB,MAAMC,EAAQ3H,SAASC,eAAe,cAChC2H,EAAa5H,SAASC,eAAe,eACrC4H,EAAY7H,SAASC,eAAe,cACpC6H,EAAa9H,SAASC,eAAe,eACrC8H,EAAc/H,SAASC,eAAe,gBAE5C,KAAK0H,GAAUC,GAAeC,GAAcC,GAAeC,GAGzD,OAFApC,GAAmB,OACnB+B,IAIFE,EAAWrF,YAAc+E,EACzBO,EAAU3H,UAAY,GAGtB,MAAMwC,EAAO7C,EAAUH,EAAiBgD,KAAQ/C,GAAoBgH,cACpE,IAAKjE,EAIH,OAHAgB,EAAkB,2BAA4B,SAC9CiC,GAAmB,OACnB+B,IAIF,MAAMM,EAAWtF,EAAKC,QAAQsF,KAAMC,GAAWA,EAAErF,KAAOjD,GACxD,IAAKoI,EAIH,OAHAtE,EAAkB,mBAAoB,SACtCiC,GAAmB,OACnB+B,IAIF,IAAIS,EAAe,GAEJ,SAAXZ,EACFY,EAAQH,EAASI,KACG,iBAAXb,EACTY,EAAQzF,EAAKoE,YAAYC,MAAMsB,OAAQC,GAAiB,OAANA,GAC9B,cAAXf,IACTY,EAAQzF,EAAK6F,SAASxB,MAAMsB,OAAQC,GAAiB,OAANA,IAG5B,IAAjBH,EAAMvF,OACRiF,EAAU3H,UAAY,uFAEtBiI,EAAM/H,QAAQ,CAACoI,EAAM1D,KACnB,MAAMzE,EAASL,SAASyI,cAAc,UAKtC,GAJApI,EAAOqI,UAAY,6BACnBrI,EAAO4C,MAAM0F,MAAQ,OACrBtI,EAAO4C,MAAM2F,aAAe,OAEb,SAAXrB,EACFlH,EAAOkC,YAAcsG,EAAeL,GACpCnI,EAAOyI,QAAUtH,UACfmG,EAAM1E,MAAMC,QAAU,aAChBsE,EAASgB,EAAK3F,IACpB6E,SAEG,CACL,MAAMqB,EAAyB,iBAAXxB,EAChB7E,EAAKoE,YAAYC,MAAMiC,UAAWV,GAAWA,GAAKA,EAAEzF,KAAO2F,EAAK3F,IAChEH,EAAK6F,SAASxB,MAAMiC,UAAWV,GAAWA,GAAKA,EAAEzF,KAAO2F,EAAK3F,IACjExC,EAAOkC,YAAcsG,EAAeL,GACpCnI,EAAOyI,QAAUtH,UACfmG,EAAM1E,MAAMC,QAAU,aAChBsE,EAASuB,EAAYtG,YAC3BiF,IAEJ,CAEAG,EAAUoB,YAAY5I,KAI1B,MAAM6I,EAAa,KACjBvB,EAAM1E,MAAMC,QAAU,OACtByC,GAAmB,EACnB+B,KAGFI,EAAWgB,QAAUI,EACrBnB,EAAYe,QAAUI,EAEtBvB,EAAM1E,MAAMC,QAAU,QAE1B,CAEA,SAAS2F,EAAehC,GACtB,GAAkB,YAAdA,EAAKV,KAAoB,CAK3B,MAAO,YAJUgD,OAAOC,QAAQvC,EAAKwC,UAClChB,OAAO,EAAErE,EAAGsF,KAAYA,EAAmB,GAC3C5E,IAAI,EAAE6E,EAAOD,KAAW,GAAGA,KAASC,KACpCpE,KAAK,OAEV,CAAA,MAAyB,YAAd0B,EAAKV,KACP,YAAYU,EAAK2C,SAAS5G,gBACV,UAAdiE,EAAKV,KACP,kBACkB,IAAhBU,EAAK4C,OACP,GAAG5C,EAAK4C,gBAEV,MACT,CAoEA,SAASlG,EAAab,GACpB,MAAMgH,EAAgBhH,EAAKC,QAAQD,EAAKiH,oBAClCC,EAAWF,GAAe7G,KAAOjD,EACtB8C,EAAKC,QAAQsF,KAAMC,GAAWA,EAAErF,KAAOjD,GACxD,MAAMiK,EAA2B,aAAfnH,EAAKY,MAGjBwG,EAAc9J,SAASC,eAAe,gBACtC8J,EAAa/J,SAASC,eAAe,eACvC6J,GAAeC,IACbF,GACFC,EAAYvH,YAAc,YAC1BwH,EAAWrB,UAAY,wCACdkB,GACTE,EAAYvH,YAAc,YAC1BwH,EAAWrB,UAAY,0CAEvBoB,EAAYvH,YAAc,eAAemH,GAAe3G,MAAQ,aAChEgH,EAAWrB,UAAY,2CAK3B,MAAMsB,EAAWhK,SAASC,eAAe,eACrC+J,IACFA,EAASzH,YAAc,QAAQG,EAAKuH,gBAAgBvH,EAAKY,WAAWZ,EAAKC,QAAQC,kBAarF,SAA6BgH,EAAmBC,GAC9C,MAAMK,EAAgBlK,SAASG,iBAAoC,wBAC7DgK,EAASP,IAAaC,IAAclE,EAE1CuE,EAAc9J,QAASK,IACrBA,EAAIyF,UAAYiE,EACZA,EACF1J,EAAIC,UAAUC,OAAO,gBAErBF,EAAIC,UAAUG,IAAI,iBAGxB,CArBEuJ,CAAoBR,EAAUC,GA/FhC,SAA6BnH,GAC3B,MAAMsF,EAAWtF,EAAKC,QAAQsF,KAAMC,GAAWA,EAAErF,KAAOjD,GACxD,IAAKoI,EAAU,OAGf,MAAMqC,EAAYrK,SAASC,eAAe,kBAC1C,GAAIoK,EAAW,CACb,MAAMC,EAAWnB,OAAOC,QAAQpB,EAASuC,SACtClC,OAAO,EAAErE,EAAGsF,KAAYA,EAAmB,GAC3C5E,IAAI,EAAE6E,EAAOD,KAAW,gCAAgCC,EAAMjE,kBAAkBiE,MAAUD,YAC1FnE,KAAK,KACRkF,EAAUnK,UAAYoK,GAAY,4CACpC,CAGA,MAAME,EAASxK,SAASC,eAAe,eACnCuK,IAC2B,IAAzBxC,EAASI,KAAKxF,OAChB4H,EAAOtK,UAAY,gDAEnBsK,EAAOtK,UAAY8H,EAASI,KACzB1D,IAAKmC,GAAc,0BAA0BgC,EAAehC,YAC5D1B,KAAK,KAKZ,MAAMsF,EAAazK,SAASC,eAAe,oBACvCwK,IAC+B,IAA7BzC,EAAS0C,SAAS9H,OACpB6H,EAAWvK,UAAY,uDAEvBuK,EAAWvK,UAAY8H,EAAS0C,SAC7BhG,IAAKmC,GAAc,0BAA0BgC,EAAehC,YAC5D1B,KAAK,KAKZ,MAAMwF,EAAgB3K,SAASC,eAAe,gBAC1C0K,IACFA,EAAczK,UAAYwC,EAAKoE,YAAYC,MACxCrC,IAAI,CAACmC,EAAW5C,IACF,OAAT4C,EACK,qCAAqC5C,EAAI,iBAE3C,0BAA0B4E,EAAehC,YAEjD1B,KAAK,KAIV,MAAMyF,EAAa5K,SAASC,eAAe,aACvC2K,IACFA,EAAW1K,UAAYwC,EAAK6F,SAASxB,MAClCrC,IAAI,CAACmC,EAAW5C,IACF,OAAT4C,EACK,qCAAqC5C,EAAI,iBAE3C,0BAA0B4C,EAAK4C,uBAEvCtE,KAAK,IAEZ,CAmCE0F,CAAoBnI,GAGpBiD,GAAmB,CACrB,CAyBA,SAASjC,EAAkBE,EAAiBuC,GAC1C,MAAM6D,EAAWhK,SAASC,eAAe,kBACpC+J,IAELA,EAASzH,YAAcqB,EACvBoG,EAAStB,UAAY,yBAAyBvC,IAC9C6D,EAAS/G,MAAMC,QAAU,QAGzB4H,WAAW,KACLd,IACFA,EAAS/G,MAAMC,QAAU,SAE1B,KACL,CAGA,MAAM6H,EAA6B,GAC7BC,EAAkB,GAExB,SAASrH,EAAeH,EAA2BoB,GACjD,IAAKlF,EAAU,OAEf,MAAMgD,EAAQhD,EAAiBgD,KAC/B,GAAKA,GAEDc,EAAQ,CACV,MAAMqB,EAASnC,EAAKC,QAAQsF,KAAMC,GAAWA,EAAErF,KAAOW,EAAOoB,UACvDqG,EAWV,SAA4BzH,EAAoBJ,GAC9C,MAAMkD,EAAY,IAAId,KAAKhC,EAAO8C,WAAW4E,qBAC7C,IAAIC,EAAa,GAEjB,OAAQ3H,EAAO2C,MACb,KAAKC,EAAWC,KACd8E,EAAa,iCACb,MACF,KAAK/E,EAAWK,iBACd0E,EAAa,yBACb,MACF,KAAK/E,EAAWY,oBACdmE,EAAa,2BACb,MACF,KAAK/E,EAAWe,eACdgE,EAAa,uBACb,MACF,QACEA,EAAa,sBAGjB,MAAO,IAAI7E,MAAclD,KAAc+H,GACzC,CAjCuBC,CAAmB5H,EAAQqB,GAAQ9B,MAAQ,WAE9DgI,EAAiBM,QAAQJ,GACrBF,EAAiBnI,OAASoI,GAC5BD,EAAiBO,MA+BvB,WACE,MAAMC,EAAavL,SAASC,eAAe,sBAC3C,IAAKsL,EAAY,OAEe,IAA5BR,EAAiBnI,OACnB2I,EAAWrL,UAAY,8CAEvBqL,EAAWrL,UAAY6K,EACpBrG,IAAI8G,GAAS,0BAA0BA,WACvCrG,KAAK,GAEZ,CAvCIsG,EACF,CACF,CAwC4B,YAAxBzL,SAAS0L,WACX1L,SAASM,iBAAiB,mBAAoBR,GAE9CA"}