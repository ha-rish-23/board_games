import{P as e,a as t}from"./p2p-w8SySoKn.js";import{A as n}from"./engine-CCVkibka.js";import"./peerjs-BtN9W7or.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();let a=null,o=null,r="",i=!1;function d(){const e=document.getElementById("app");e?(e.innerHTML='\n    <div class="container">\n      <h1>Century: Golem Edition</h1>\n      <p class="subtitle">Peer-to-Peer Multiplayer - No Server Required</p>\n      \n      <div class="tabs">\n        <button class="tab-btn active" data-tab="create">Create Room</button>\n        <button class="tab-btn" data-tab="join">Join Room</button>\n      </div>\n      \n      <div class="tab-content active" id="create-tab">\n        <h2>Create a Game Room</h2>\n        <form id="create-form">\n          <div class="form-group">\n            <label>Your Name:</label>\n            <input type="text" id="host-name-input" placeholder="Enter your name" required />\n          </div>\n          <div class="form-group">\n            <label>Number of Players:</label>\n            <input type="number" id="player-count" min="2" max="5" value="3" />\n          </div>\n          <button type="submit" class="btn-primary">Create Room</button>\n        </form>\n        <div id="room-info" style="display:none;">\n          <h3>Room Created</h3>\n          <p><strong>Share this Room Code with other players:</strong></p>\n          <div style="margin: 15px 0;">\n            <div class="room-code" id="room-code-display"></div>\n          </div>\n          <div id="players-waiting" style="margin-top: 20px;">\n            <h4>Players Connected: <span id="connected-count">1</span>/<span id="total-count">3</span></h4>\n            <div id="player-list"></div>\n            <p style="margin-top: 15px; color: #6B5D50; font-size: 14px;">Game will start automatically when all players join.</p>\n          </div>\n        </div>\n      </div>\n      \n      <div class="tab-content" id="join-tab">\n        <h2>Join a Game Room</h2>\n        <form id="join-form">\n          <div class="form-group">\n            <label>Room Code:</label>\n            <input type="text" id="room-code-input" placeholder="e.g., A3F9K2" required />\n          </div>\n          <div class="form-group">\n            <label>Your Name:</label>\n            <input type="text" id="player-name-input" placeholder="Enter your name" required />\n          </div>\n          <button type="submit" class="btn-primary">Join Room</button>\n        </form>\n      </div>\n      \n      <div id="game-area" style="display:none;">\n        <h2>Game in Progress</h2>\n        \n        <div id="player-identity" class="info-panel">\n          <strong>You are:</strong> <span id="your-player-name"></span>\n          <span id="host-indicator" style="display:none;" class="badge-host">HOST</span>\n        </div>\n        \n        <div id="turn-status" class="info-panel turn-indicator">\n          <strong id="turn-message">Waiting...</strong>\n        </div>\n        \n        <div id="status-message" class="status-message"></div>\n        \n        <div id="game-status" class="game-meta"></div>\n        \n        <div id="game-state" class="game-state">\n          <div class="player-section">\n            <h4>Your Caravan</h4>\n            <div id="player-caravan" class="caravan-display"></div>\n          </div>\n          <div class="player-section">\n            <h4>Your Hand</h4>\n            <div id="player-hand" class="card-display"></div>\n          </div>\n          <div class="player-section">\n            <h4>Play Area</h4>\n            <div id="player-play-area" class="card-display"></div>\n          </div>\n        </div>\n        \n        <div id="shared-board" class="shared-board">\n          <div class="board-section">\n            <h4>Merchant Cards</h4>\n            <div id="merchant-row" class="merchant-display"></div>\n          </div>\n          <div class="board-section">\n            <h4>Point Cards</h4>\n            <div id="point-row" class="point-display"></div>\n          </div>\n        </div>\n        \n        <div id="game-actions" class="action-buttons">\n          <button class="btn-action" id="action-play-card" disabled>Play Card</button>\n          <button class="btn-action" id="action-take-merchant" disabled>Take Merchant</button>\n          <button class="btn-action" id="action-claim-vp" disabled>Claim Points</button>\n          <button class="btn-action" id="action-rest" disabled>Rest</button>\n        </div>\n        \n        <div id="action-log" class="action-log">\n          <h3>Action Log</h3>\n          <div id="action-log-content"></div>\n        </div>\n      </div>\n      \n      <div id="card-modal" class="modal" style="display:none;">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h3 id="modal-title">Select Card</h3>\n            <button class="modal-close" id="modal-close">&times;</button>\n          </div>\n          <div class="modal-body" id="modal-body"></div>\n          <div class="modal-footer">\n            <button class="btn-action" id="modal-cancel">Cancel</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',function(){document.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-tab");t&&function(e){document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-tab="${e}"]`)?.classList.add("active"),document.querySelectorAll(".tab-content").forEach(e=>{e.classList.remove("active")}),document.getElementById(`${e}-tab`)?.classList.add("active")}(t)})});const e=document.getElementById("create-form");e?.addEventListener("submit",s);const t=document.getElementById("join-form");t?.addEventListener("submit",l),document.getElementById("action-play-card")?.addEventListener("click",()=>p("play-card")),document.getElementById("action-take-merchant")?.addEventListener("click",()=>p("take-merchant")),document.getElementById("action-claim-vp")?.addEventListener("click",()=>p("claim-vp")),document.getElementById("action-rest")?.addEventListener("click",()=>p("rest"))}()):console.error("App mount point not found")}async function s(t){t.preventDefault();const n=document.getElementById("host-name-input").value.trim(),o=parseInt(document.getElementById("player-count").value);if(!n)return void alert("Please enter your name");const d=document.getElementById("room-info"),s=document.getElementById("room-code-display");if(d&&s)try{a=new e,a.on("room-created",({roomCode:e,hostPeerId:t,playerCount:n})=>{s.textContent=e;const o=document.getElementById("total-count");o&&(o.textContent=n.toString());const l=a.game;if(l&&l.players&&l.players.length>0){r=l.players[0].id,i=!0;const e=document.getElementById("your-player-name");e&&(e.textContent=l.players[0].name);const t=document.getElementById("host-indicator");t&&(t.style.display="inline-block")}c(),d.style.display="block"}),a.on("peer-connected",({playerName:e})=>{c()}),a.on("game-state-updated",e=>{const t=document.getElementById("game-area");if(t&&"PLAYING"===e.phase){const n=document.getElementById("room-info");n&&(n.style.display="none"),t.style.display="block",g(e)}}),a.on("action-processed",(e,t)=>{t?(f("Action processed successfully","success"),E(e,r)):f("Action processing failed","error")}),a.on("room-error",e=>{f(`Error: ${e.message}`,"error")});const t=[n,...Array.from({length:o-1},(e,t)=>`Player ${t+2}`)];await a.createRoom(t)}catch(l){alert(`Failed to create room: ${l.message}`)}}function c(){if(!a)return;const e=document.getElementById("player-list"),t=document.getElementById("connected-count");if(!e||!t)return;const n=a.game,o=a.playerConnections;if(!n)return;const r=new Set(Array.from(o.values()).map(e=>e.playerId));e.innerHTML=n.players.map((e,t)=>{const n=r.has(e.id),a=n?"Connected":"Waiting...",o=0===t?" (Host)":"";return`<div style="padding: 5px 0;">${n?"✅":"⏳"} ${e.name}${o} - ${a}</div>`}).join(""),t.textContent=r.size.toString()}async function l(e){e.preventDefault();const n=document.getElementById("room-code-input").value.trim().toUpperCase(),a=document.getElementById("player-name-input").value.trim();if(!n||!a)return void alert("Please fill in all fields");const d=`boardgame-${n.toLowerCase()}`;try{o=new t,o.on("connected",()=>{document.getElementById("create-tab").style.display="none",document.getElementById("join-tab").style.display="none";const e=document.getElementById("game-area");if(e){e.style.display="block";const t=document.getElementById("your-player-name");t&&(t.textContent=a),f(`Connected to room ${n}`,"success")}i=!1}),o.on("disconnected",()=>{f("Disconnected from room","error")}),o.on("host-disconnected",()=>{const e=document.getElementById("game-area");e&&(e.innerHTML='\n          <h2>Game Ended</h2>\n          <p style="padding: 20px; background: rgba(244, 67, 54, 0.2); border-radius: 8px;">\n            <strong>Host disconnected.</strong><br><br>\n            The host has closed their browser or lost connection.<br>\n            The game cannot continue without the host.<br><br>\n            Please refresh to start a new game.\n          </p>\n        ')}),o.on("game-state-received",e=>{g(e),E(null,r)}),o.on("action-accepted",e=>{f("Sending action to host...","info")}),o.on("action-rejected",(e,t)=>{f(`Invalid action: ${t}`,"error")}),o.on("error",e=>{f(`Error: ${e.message}`,"error")}),r=`player_${Date.now()}`,await o.joinRoomWithPeerId(n,d,r,a)}catch(s){alert(`Failed to join room: ${s.message}`)}}let m=!1;async function u(e){if(i){f("Processing action...","info");const t=a.processAction(e);t.valid?(f("Action processed successfully","success"),E(e)):f(`Invalid action: ${t.error}`,"error"),m=!1}else{if(!o)return f("Not connected to room","error"),void(m=!1);f("Sending action to host...","info"),await o.sendAction(e)}}async function p(e){if(!m)if(r)if(!i||a)if(i||o)try{let t;switch(m=!0,document.querySelectorAll("#game-actions button").forEach(e=>{e.disabled=!0,e.classList.add("btn-disabled")}),e){case"rest":t={type:n.Rest,playerId:r,timestamp:Date.now()};break;case"play-card":return void(await y("Play a card from your hand","hand",async e=>{t={type:n.PlayMerchantCard,playerId:r,timestamp:Date.now(),cardId:e},await u(t)}));case"take-merchant":return void(await y("Acquire merchant card","merchant-row",async e=>{const d=i?a.game:o?.lastGameState,s=parseInt(e),c=d?.merchantRow.cards[s];if(!c)return f("Invalid card selection","error"),void(m=!1);t={type:n.AcquireMerchantCard,playerId:r,timestamp:Date.now(),rowIndex:s,cardId:c.id},await u(t)}));case"claim-vp":return void(await y("Claim point card","point-row",async e=>{const d=i?a.game:o?.lastGameState,s=parseInt(e),c=d?.pointCardRow.cards[s];if(!c)return f("Invalid card selection","error"),void(m=!1);t={type:n.ClaimPointCard,playerId:r,timestamp:Date.now(),rowIndex:s,cardId:c.id,payment:c.cost},await u(t)}));default:return f("Unknown action type","error"),void(m=!1)}await u(t)}catch(t){f(`Failed to send action: ${t.message}`,"error"),m=!1}else f("Not connected to a room","error");else f("Host room not initialized","error");else f("Player ID not set","error")}function y(e,t,n){return new Promise(d=>{const s=document.getElementById("card-modal"),c=document.getElementById("modal-title"),l=document.getElementById("modal-body"),u=document.getElementById("modal-close"),p=document.getElementById("modal-cancel");if(!(s&&c&&l&&u&&p))return m=!1,void d();c.textContent=e,l.innerHTML="";const y=i?a.game:o?.lastGameState;if(!y)return f("Game state not available","error"),m=!1,void d();const g=y.players.find(e=>e.id===r);if(!g)return f("Player not found","error"),m=!1,void d();let h=[];"hand"===t?h=g.hand:"merchant-row"===t?h=y.merchantRow.cards.filter(e=>null!==e):"point-row"===t&&(h=y.pointRow.cards.filter(e=>null!==e)),0===h.length?l.innerHTML='<p style="padding: 20px; text-align: center; color: #6B5D50;">No cards available</p>':h.forEach((e,a)=>{const o=document.createElement("button");if(o.className="btn-action card-select-btn",o.style.width="100%",o.style.marginBottom="10px","hand"===t)o.textContent=v(e),o.onclick=async()=>{s.style.display="none",await n(e.id),d()};else{const a="merchant-row"===t?y.merchantRow.cards.findIndex(t=>t&&t.id===e.id):y.pointRow.cards.findIndex(t=>t&&t.id===e.id);o.textContent=v(e),o.onclick=async()=>{s.style.display="none",await n(a.toString()),d()}}l.appendChild(o)});const b=()=>{s.style.display="none",m=!1,d()};u.onclick=b,p.onclick=b,s.style.display="flex"})}function v(e){if("PRODUCE"===e.type){return`Produce: ${Object.entries(e.produces).filter(([e,t])=>t>0).map(([e,t])=>`${t} ${e}`).join(", ")}`}return"UPGRADE"===e.type?`Upgrade: ${e.upgrades.length} levels`:"TRADE"===e.type?"Trade Card":void 0!==e.points?`${e.points} Points`:"Card"}function g(e){const t=e.players[e.currentPlayerIndex],n=t?.id===r;e.players.find(e=>e.id===r);const a="FINISHED"===e.phase,o=document.getElementById("turn-message"),i=document.getElementById("turn-status");o&&i&&(a?(o.textContent="Game Over",i.className="info-panel turn-indicator turn-ended"):n?(o.textContent="YOUR TURN",i.className="info-panel turn-indicator turn-active"):(o.textContent=`Waiting for ${t?.name||"opponent"}`,i.className="info-panel turn-indicator turn-waiting"));const d=document.getElementById("game-status");d&&(d.textContent=`Turn ${e.turnNumber} • ${e.phase} • ${e.players.length} players`),function(e,t){const n=document.querySelectorAll("#game-actions button"),a=e&&!t&&!m;n.forEach(e=>{e.disabled=!a,a?e.classList.remove("btn-disabled"):e.classList.add("btn-disabled")})}(n,a),function(e){const t=e.players.find(e=>e.id===r);if(!t)return;const n=document.getElementById("player-caravan");if(n){const e=Object.entries(t.caravan).filter(([e,t])=>t>0).map(([e,t])=>`<span class="crystal crystal-${e.toLowerCase()}">${e}: ${t}</span>`).join(" ");n.innerHTML=e||'<span style="color: #8B7355;">Empty</span>'}const a=document.getElementById("player-hand");a&&(0===t.hand.length?a.innerHTML='<span style="color: #8B7355;">No cards</span>':a.innerHTML=t.hand.map(e=>`<div class="card-item">${v(e)}</div>`).join(""));const o=document.getElementById("player-play-area");o&&(0===t.playArea.length?o.innerHTML='<span style="color: #8B7355;">No cards played</span>':o.innerHTML=t.playArea.map(e=>`<div class="card-item">${v(e)}</div>`).join(""));const i=document.getElementById("merchant-row");i&&(i.innerHTML=e.merchantRow.cards.map((e,t)=>null===e?`<div class="card-slot empty">Slot ${t+1}: Empty</div>`:`<div class="card-slot">${v(e)}</div>`).join(""));const d=document.getElementById("point-row");d&&(d.innerHTML=e.pointRow.cards.map((e,t)=>null===e?`<div class="card-slot empty">Slot ${t+1}: Empty</div>`:`<div class="card-slot">${e.points} Points</div>`).join(""))}(e),m=!1}function f(e,t){const n=document.getElementById("status-message");n&&(n.textContent=e,n.className=`status-message status-${t}`,n.style.display="block",setTimeout(()=>{n&&(n.style.display="none")},5e3))}const h=[],b=10;function E(e,t){if(!a)return;const o=a.game;if(o&&e){const t=o.players.find(t=>t.id===e.playerId),a=function(e,t){const a=new Date(e.timestamp).toLocaleTimeString();let o="";switch(e.type){case n.Rest:o="rested and took all cards back";break;case n.PlayMerchantCard:o="played a merchant card";break;case n.AcquireMerchantCard:o="acquired a merchant card";break;case n.ClaimPointCard:o="claimed a point card";break;default:o="performed an action"}return`[${a}] ${t} ${o}`}(e,t?.name||"Unknown");h.unshift(a),h.length>b&&h.pop(),function(){const e=document.getElementById("action-log-content");if(!e)return;0===h.length?e.innerHTML='<div class="log-empty">No actions yet</div>':e.innerHTML=h.map(e=>`<div class="log-entry">${e}</div>`).join("")}()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d();
//# sourceMappingURL=main-BTUVFRph.js.map
